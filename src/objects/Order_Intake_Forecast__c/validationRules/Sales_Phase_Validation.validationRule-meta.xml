<?xml version="1.0" encoding="UTF-8"?>
<ValidationRule xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>Sales_Phase_Validation</fullName>
    <active>true</active>
    <description>If Sales Phase on Oppty is NOT &apos;Handover&apos; or &apos;Execute&apos; and Forecast Category is &apos;Booked&apos;(Req:397)</description>
    <errorConditionFormula>OR(
AND( 
(ISNEW()||ISCHANGED(Forecast_Category__c)),
( $Profile.Name&lt;&gt;$Label.Data_Loader_Profile_Name),

NOT( 
OR( 
ISPICKVAL( 
Opportunity__r.StageName ,&apos;Handover (Prepare for Delivery)&apos;) 
, 
ISPICKVAL( 
Opportunity__r.StageName ,&apos;Execute (Start Delivery)&apos;), 
ISPICKVAL( 
Opportunity__r.StageName ,&apos;Completed&apos;) 

)
),
Opportunity__r.Advanced_PO_Booking__c = FALSE 
),
AND(
 (ISNEW()||ISCHANGED(Forecast_Category__c)),
( $Profile.Name&lt;&gt;$Label.Data_Loader_Profile_Name),
NOT( 
OR( 
ISPICKVAL( 
Opportunity__r.StageName ,&apos;Handover (Prepare for Delivery)&apos;) 
, 
ISPICKVAL( 
Opportunity__r.StageName ,&apos;Execute (Start Delivery)&apos;), 
ISPICKVAL( 
Opportunity__r.StageName ,&apos;Completed&apos;),
ISPICKVAL( Opportunity__r.StageName ,&apos;Win the Case (Negotiate)&apos;) 

)
),
Opportunity__r.Advanced_PO_Booking__c = TRUE
)
)

&amp;&amp; 
ISPICKVAL( Forecast_Category__c ,&apos;Booked&apos;)
&amp;&amp;
ISBLANK(Cloned_From__c)</errorConditionFormula>
    <errorDisplayField>Forecast_Category__c</errorDisplayField>
    <errorMessage>You cannot book OIF before Win Declaration is complete unless Advanced PO Booking is checked on Opportunity page and G4 approved.</errorMessage>
</ValidationRule>
